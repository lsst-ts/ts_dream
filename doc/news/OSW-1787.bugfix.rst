Added cooperative task cancellation and avoid cancelling a task within its child.
